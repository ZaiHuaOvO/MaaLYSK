
# MaaLYSK零基础开发指南
<!-- markdownlint-disable MD029 -->

> [!NOTE]
>
> 只有当您想要开发MaaLYSK时才需要看当前页面！
> 用户请转到 [使用手册](../../zh_cn/manual/1.1-快速开始.md)
> 开发 MaaFramework 或开发自己的项目请到 [MaaXYZ/MaaFramework](https://maafw.xyz)
>
> 本篇文档参考：MAA、MaaLYSK开发指南编写！
>
> [开发指南 | MAA 文档站](https://docs.maa.plus/zh-cn/develop/development.html#完整环境配置流程-windows)
>
> [开发前须知 | MaaLYSK 文档站](https://1999.fan/zh_cn/develop/development.html#我有编程经验-但是没参与过相关项目-要怎么做)

## Github Pull Request 代码提交流程简述

- ### 我不懂编程，只是想改一点点 JSON 文件/文档等，要怎么操作？

欢迎收看 [牛牛也能看懂的 GitHub Pull Request 使用指南](https://maa.plus/docs/zh-cn/develop/pr-tutorial.html)

简单来说，就是整个文件夹用VScode打开，找到想编辑的代码在VScode里编辑好，然后把改好的代码粘贴到github网站上进行PR。

> [!NOTE]
>
> PR的基本格式要求（**约定式提交**）：便于我查看和了解你这个代码干了什么，是加了新功能/改了bug/改了文档。。。
>
> [conventionalcommits.org/zh-hans/v1.0.0/](https://www.conventionalcommits.org/zh-hans/v1.0.0/)

- ### 我有编程经验，想在本地进行较为完整的项目开发，应该怎么操作？

  利用git，实现本地（你的文件夹）--

#### 1、前置准备

1. 下载并安装VSCode

   官网：[https://code.visualstudio.com](https://code.visualstudio.com/)

   推荐下载好后，在扩展里找到`Maa Pipeline Support`，进行下载安装。可以进行调试，截图、取ROI等操作，不对的会进行报错提醒。

   <img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/image-20251222231854640.png" alt="image-20251222231854640" style="zoom:67%;" />

> [!TIP]
>
> - 可以下个代码补全的插件，一键补全，好用！
>
> - 代码格式化工具推荐`Prettier`，作者Prettier蓝标
>

2. 下载并安装git（官网：<https://git-scm.com/> ）

   <img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/image-20251222231248389.png" alt="image-20251222231248389" width="45%" /> <img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/image-20251222231327262.png" alt="image-20251222231327262" width="45%" />

3. 下载并安装Python（≥3.11）

   官网：[Welcome to Python.org](https://www.python.org/)

> [!TIP]
>
> 安装教程：
>
> 79 fastinstall发布了一篇小红书笔记，快来看吧！ 😆 q16mTm9mycRvoaa 😆 <http://xhslink.com/a/2lRUfHM42bt6，复制本条信息，打开【小红书】App查看精彩内容！>

#### 2、代码配置

1. 如果很久以前 fork 过，先在自己仓库的 `Settings` 里，翻到最下面，删除

2. 打开 [MaaLYSK主仓库](https://github.com/Witty36/MaaLYSK)，点击 `Fork`，继续点击 `Create fork`

3. 按照提示fork好之后，接下来就会来到你的个人仓库，可以看到标题是 **“你的用户名/MaaLYSK**”，下面一行小字 **forked fromWitty36/MaaLYSK**（复制自 MaaYuan 主仓库）

    *图片仅为示例，应该`fork`MaaLYSK主仓库而不是MaaFramework！

     <img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/image-20251222230153165.png" alt="image-20251222230153165" style="zoom:67%;" />

4. 克隆你自己的仓库到本地，并拉取子模块

    下了git后，在命令行cmd/powershell中运行

    ```bash
    git clone --recursive https://github.com/<你的用户名>/MaaLYSK.git      
    git clone --recursive https://github.com/<你的用户名>/MaaLYSK.git F:\<你的文件夹>   #安装到指定文件夹
    ```

   > [!WARNING]
   > **--recursive 一定不要忘！--recursive 一定不要忘！--recursive 一定不要忘！**  
   > OCR异常失败很可能就是没加recursive导致

    如已克隆但发现资源缺失，可运行：

    ```bash
    git submodule update --init --recursive
    ```

    *想要在指定文件夹下载？在你心仪的文件夹右键——`在终端中打开`/`Open git bash here`输入git命令。

    或`win`+`R`，输入`cmd`后，输入

    ```sh
    cd /d F:\<你的文件夹> #转换默认cmd路径至指定文件夹，powershell和bash的指令可能有所不同
    ```

    <img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/image-20251222232614196.png" alt="image-20251222232614196" width="20%" />

    > 我没有下git/git下载不下来/git clone总是失败，怎么办？
    >
    > 这是因为git clone需要本地代理，没有代理的需要搜索镜像源。或者：
    >
    > 1、在github上下载code的压缩包
    >
    > <img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/image-20251222233450703.png" alt="image-20251222233450703" width="20%" />
    >
    > 2、下载 OCR（文字识别）资源文件 [ppocr_v5.zip](https://download.maafw.xyz/MaaCommonAssets/OCR/ppocr_v5/ppocr_v5-zh_cn.zip) 解压到 `assets/resource/model/ocr/` 目录下，确保路径如下：
    >
    > ```sh
    > assets/resource/model/ocr/
    > ├── det.onnx
    > ├── keys.txt
    > └── rec.onnx
    > ```

5. 下载 MaaFramework 的 [Release 包](https://github.com/MaaXYZ/MaaFramework/releases)，解压到 `deps` 文件夹中。

> [!TIP]
>
> 目前可跳过这步，仅在需要本地测试命令行版本时执行

6. 配置编程环境

    - 即python、VScode，选一个Maa的开发工具

    - Maa调试/开发工具列表

        | 工具 | 简介 |
        | --- | --- |
        | [MaaDebugger](https://github.com/MaaXYZ/MaaDebugger) | 独立调试工具 |
        | [Maa Pipeline Support](https://marketplace.visualstudio.com/items?itemName=nekosu.maa-support) | VSCode 插件，提供调试、截图、获取 ROI 、取色等功能 |
        | [MFA Tools(仅win)](https://github.com/SweetSmellFox/MFATools) | 独立截图、获取 ROI 、滑动、文字及取色工具 |
        | [ImageCropper(不推荐)](https://github.com/MaaXYZ/MaaFramework/tree/main/tools/ImageCropper) | 独立截图及获取 ROI 工具 |
        | [MaaLogAnalyzer](https://github.com/Windsland52/MAALogAnalyzer) | 可视化分析基于 MaaFramework 开发应用的日志 |
        | [MaaPipelineExtremer - Editor](https://mpe.codax.site/stable/) | MPE网站，可视化编辑和分析MaaLYSK的流程代码 |

> [!TIP]
> 推荐使用 VSCode 插件进行开发调试、MaaLogAnalyzer 进行用户日志分析、MPE进行流程查看梳理思路
>
> 安装插件后，如果写的时候哪里不对都会**标红**。等vscode里都不红了之后再用Maa Debugger/Maa Pipeline support调试看运行流程有没有问题。

7. 开始开发

    在项目的根目录运行 `python ./tools/ci/configure.py` 配置OCR模型。

    使用上一个步骤中安装的调试/开发工具开发MaaLYSK，虚拟环境会自动创建在`.venv`目录中。

    开始愉快的MaaLYSK代码之旅，可以官方文档的使用参考。

    [任务流水线（Pipeline）协议 | MaaFramework](https://maafw.xyz/docs/3.1-PipelineProtocol)

    [Project Interface V2 协议 | MaaFramework](https://maafw.xyz/docs/3.3-ProjectInterfaceV2)

    [回调协议 | MaaFramework](https://maafw.xyz/docs/2.3-CallbackProtocol)

    [专用 VSCode 插件教程 | MAA 文档站](https://docs.maa.plus/zh-cn/develop/vsc-ext-tutorial.html#语义化资源分析)

> [!IMPORTANT]
>
> 主要要编的代码：
>
> 1、每个任务的代码（pipeline）：在`resource/pipeline`下面的`.json`文件里（每个任务的单独代码，就是识别到xx点击，接下来再识别xx，编写的规则参照`任务流水线（Pipeline）协议`
>
> 2、显示在gui上的页面（Interface）：在`interface.json`中（任务写好了，想让它显示在gui中，并且能够显示任务说明、选项内容，参照`Project Interface V2 协议`
>
> 3、选项的实现：在`interface.json`中写每个选项对应的`pipeline_override`，比如银砂/辉曜的切换，就是通过在override里写收取信号之后，下一步识别”银砂”还是“辉曜”实现
>
> 4、日志中消息提醒（focus）：在每个`node`中编写`focus`信息实现，具体参照`1.2节点信息输出.md`和官方文档`回调协议`
>
> 话不多说，自行看代码更好理解！可参考MaaLYSK、MaaYuan、MaaLYSK的已有代码进行理解

8. git 操作（命令行版）

    通常用的最多的基本命令有：
    - `git add <file>`：添加文件到暂存区，`*` 代表全部文件
    - `git commit -m "message"`：提交暂存区到本地仓库。`message` 请遵循 [约定式提交规范](https://www.conventionalcommits.org/zh-hans/v1.0.0/)，让你的 commit 信息更加清晰
    - `git pull origin <branch>`：拉取远程仓库到本地仓库
    - `git push origin <branch>`：推送本地仓库到远程仓库
  
    ```bash
    git checkout -b <branch-name> # 创建并切换到新的分支
    ```

    完成开发后，推送你修改的本地分支到远程仓库（fork 的仓库，地址中是你的用户名）

    ```bash
    git push origin <branch-name>
    ```

    - 当 MaaLYSK仓库出现更改（如其他人的commit），你可能需要把这些更改同步到你的分支

    1.关联 MaaLYSK 原仓库：

    ```sh
    git remote add upstream https://github.com/Witty36/MaaLYSK.git
    ```

    2.拉取远程仓库更新：

    ```sh
    git fetch upstream
    ```

    3.变基（推荐）或者合并修改：

    ```sh
    git rebase upstream/main # 变基，使commit历史更清晰，完成你的个人pr时建议使用rebase而不是merge来合并修改
    ```

    - git 参考资料：

      - [git 官方文档](https://git-scm.com/docs)
      - [git 简明指南](https://www.runoob.com/manual/git-guide/)
      - [git 教程|菜鸟教程](https://www.runoob.com/git/git-tutorial.html)

<img src="https://github.com/Witty36/MaaLYSK/blob/main/docs/doc_image/8f4e3842270fbef01c4c77fab93e9bf.jpg" alt="8f4e3842270fbef01c4c77fab93e9bf" width="60%" />

> 不会用命令行？在VSCode里也可以提交！
>
> - ctrl+s进行保存。`源代码管理处`可以进行拉取（git pull）、暂存（git add）、提交（git commit）、推送（git push）等操作，同命令行操作差不多。
> - 参照[给傻子的Git教程_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Hkr7YYEh8/?share_source=copy_web&vd_source=8bafc3ece922b649199728a9cf446699)

> [!WARNING]
> 开发过程中，每一定数量，记得提交一个 commit, 别忘了写上 message
>
> 假如你不熟悉 git 的使用，你可能需要创建并切换到一个新的分支，而不是直接提交在 main 上
>
> 这样你的提交就能在新的分支上生长，不会受到 main 更新的打扰

9. 提交 Pull Request

    你修改的代码已经提交到你的仓库（github网站上[你的远程仓库](https://github.com/<你的用户名>/MaaLYSK)，为`origin/<分支名>`），现在你需要提交一个 Pull Request 到 MaaLYSK的仓库（github上面[MaaLYSK的总仓库](https://github.com/Witty36/MaaLYSK)，`upstream/<分支名>`），等待维护者审核

    [GitHub Pull Request 参考](https://maa.plus/docs/zh-cn/develop/pr-tutorial.html)

## MaaLYSK格式化要求

MaaLYSK 使用一系列的格式化工具来保证仓库中的代码和资源文件美观统一，以便于维护和阅读

请确保在提交之前已经格式化，或是启用 Pre-commit Hooks 进行自动格式化

目前启用的格式化工具如下：

| 文件类型 | 格式化工具 |
| --- | --- |
| JSON/Yaml | [prettier](https://prettier.io/) |
| Markdown | [MarkdownLint](https://github.com/DavidAnson/markdownlint-cli2) |

### 利用 Pre-commit Hooks 自动进行代码格式化

> [!TIP]
> 实际协作中，在 vscode 中开发，安装推荐的插件后，基本就可以完成自动格式化了，故该部分可跳过。

1. 确保你的电脑上有 Python 与 Node 环境

2. 在项目根目录下执行以下命令

    ```bash
    pip install pre-commit
    pre-commit install
    ```

如果pip安装后依然无法运行pre-commit，请确认pip安装地址已被添加到PATH

接下来，每次提交时都将会自动运行格式化工具，来确保你的代码格式符合规范

手动触发：
    ```bash
    pre-commit run --all-files
    ```
