# 1.2 节点信息输出

## Piphline流水线协议消息输出模版

```jsonc
// 在 Pipeline 中配置消息模板
{
  "NodeA": {
    "focus": {
      "Node.Recognition.Succeeded": "{name} 识别命中，准备开始执行",
      "Node.Action.Starting": "{name} 开始执行，任务 ID: {task_id}",
    }
  }
}

// 当该节点开始执行时，UI 即会收到回调
{
  "message": "Node.Action.Starting",
  "details_json": {
    "task_id": 12345,
    "action_id": 11111,
    "name": "NodeA",
    "focus": {
      "Node.Recognition.Succeeded": "{name} 识别命中，准备开始执行",
      "Node.Action.Starting": "{name} 开始执行，任务 ID: {task_id}"
    }
  }
}
```

| 消息类型                      | 触发时机           | 可用占位符                        |
| ----------------------------- | ------------------ | --------------------------------- |
| `Resource.Loading.Succeeded`  | 资源加载成功       | `res_id`, `hash`, `path`          |
| `Resource.Loading.Failed`     | 资源加载失败       | `res_id`, `hash`, `path`          |
| `Controller.Action.Starting`  | 控制器开始执行     | `ctrl_id`,`uuid`,`action`,`param` |
| `Controller.Action.Succeeded` | 控制器执行成功     | `ctrl_id`,`uuid`,`action`,`param` |
| `Controller.Action.Failed`    | 控制器执行失败     | `ctrl_id`,`uuid`,`action`,`param` |
| `Tasker.Task.Starting`        | 任务开始执行       | `task_id`,`entry`,`uuid`,`hash`   |
| `Tasker.Task.Succeeded`       | 任务执行成功       | `task_id`,`entry`,`uuid`,`hash`   |
| `Tasker.Task.Failed`          | 任务执行失败       | `task_id`,`entry`,`uuid`,`hash`   |
| `Node.Recognition.Starting`   | 节点识别开始       | `task_id`, `reco_id`, `name`      |
| `Node.Recognition.Succeeded`  | 节点识别成功       | `task_id`, `reco_id`, `name`      |
| `Node.Recognition.Failed`     | 节点识别失败       | `task_id`, `reco_id`, `name`      |
| `Node.Action.Starting`        | 节点动作开始       | `task_id`, `action_id`, `name`    |
| `Node.Action.Succeeded`       | 节点动作成功       | `task_id`, `action_id`, `name`    |
| `Node.Action.Failed`          | 节点动作失败       | `task_id`, `action_id`, `name`    |
| `Node.NextList.Starting`      | 下一步节点开始识别 | `task_id`,`name`,`list`           |
| `Node.NextList.Succeeded`     | 下一步节点识别成功 | `task_id`,`name`,`list`           |
| `Node.NextList.Failed`        | 下一步节点识别失败 | `task_id`,`name`,`list`           |
| `Node.PipelineNode.Starting`  | 流水线节点开始执行 | `task_id`, `node_id`,`name`       |
| `Node.PipelineNode.Succeeded` | 流水线节点执行成功 | `task_id`, `node_id`,`name`       |
| `Node.PipelineNode.Failed`    | 流水线节点执行失败 | `task_id`, `node_id`,`name`       |

节点识别（Node.Recognition.x）:

- `task_id`: 任务 ID（数字）
- `reco_id`: 识别 ID（数字）
- `name`: 节点名称（字符串）
- `focus`: 焦点相关数据（任意类型）

节点动作（Node.Action.x）:

- `task_id`: 任务 ID（数字）
- `action_id`: 操作 ID（数字）
- `name`: 节点名称（字符串）
- `focus`: 焦点相关数据（任意类型）

下一步节点（Node.NextList.x）:

- `task_id`: 任务 ID（数字）
- `name`: 节点名称（字符串）
- `list`: 下一步节点列表（对象数组）
  - `name`: 节点名称或锚点名称（字符串）
  - `jump_back`: 是否回跳（布尔值）
  - `anchor`: 是否为锚点引用（布尔值），若为 true 则 name 为锚点名称
- `focus`: 焦点相关数据（任意类型）

流水线节点（Node.PipelineNode.x）:

*整个节点的状态，失败是on_error状态 如果用nextlist，会有多次识别失败记录，用pipelinenode则指这个节点失败

- `task_id`: 任务 ID（数字）
- `node_id`: 节点 ID（数字）
- `name`: 节点名称（字符串）

资源类型（Resource.Loading.x）：

- `res_id`: 资源 ID（数字）
- `hash`: 资源哈希值（字符串）
- `path`: 资源路径（字符串）

控制器（Controller.Action.x）:

- `ctrl_id`: 控制器 ID（数字）
- `uuid`: 唯一标识符（字符串）
- `action`: 动作类型（字符串）
- `param`: 动作参数（对象）

任务（Tasker.Task.x）：

- `task_id`: 任务 ID（数字）
- `entry`: 入口任务名称（字符串）
- `uuid`: 唯一标识符（字符串）
- `hash`: 任务哈希值（字符串）

## MFAA interface字段配置

| 字段            | 类型    | 默认值  | 说明                       |
| --------------- | ------- | ------- | -------------------------- |
| `name`          | string  | -       | 任务显示名称               |
| `entry`         | string  | -       | 任务入口接口               |
| `default_check` | boolean | `false` | 是否默认选中               |
| `description`   | string  | `null`  | 任务说明文档（支持富文本） |
| `repeatable`    | boolean | `false` | 是否可重复执行             |
| `repeat_count`  | number  | `1`     | 默认重复次数               |

| 标记                      | 效果       | 示例                          |
| ------------------------- | ---------- | ----------------------------- |
| `[color:颜色]...[/color]` | 文字颜色   | `[color:red]红色文字[/color]` |
| `[b]...[/b]`              | **粗体**   | `[b]粗体文字[/b]`             |
| `[i]...[/i]`              | *斜体*     | `[i]斜体文字[/i]`             |
| `[u]...[/u]`              | 下划线     | `[u]下划线文字[/u]`           |
| `[s]...[/s]`              | ~~删除线~~ | `[s]删除线文字[/s]`           |
